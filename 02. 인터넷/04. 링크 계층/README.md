## 링크 계층

</br>

### 2.4.1 링크 계층의 개념

전자기학을 벗아나 컴퓨터공학이 본격적으로 적용되는 곳은 링크 계층이다. 링크 계층은 **물리적으로 연결된 호스트 사이의 통신 수단을 제공**한다.

링크 계층은 송신 호스트가 정보를 꾸려 물리 계층을 통해 정보를 보낼 수 있는 수단을 제공한다.

또한, 링크 계층은 수신 호스트가 높은 확률로 그 정보를 수신하여 안에 담긴 정보를 꺼낼 수 있게 하는 수단을 제공한다.

</br>

### 2.4.2 링크 계층의 역할

링크 계층의 송수신 단위는 프레임(frame)이라 한다. 각 호스트는 링크 계층을 통해 서로에게 프레임을 주고 받는다.

링크 계층의 역할을 좀 더 나눠보면 다음과 같다.

1. 특정 **목적지에 주소를 부여해서 각 프레임에 기재**하여 호스트를 식별할 수단을 제공한다.

2. 수신 측 주소와 데이터를 담을 수 있는 **프레임 포맷을 정의**한다.

3. 한 번에 전송할 수 있는 데이터의 양을 상위 계층에서 알 수 있게 **프레임의 최대 길이를 정의**한다.

4. 물리 계층을 거쳐 전달된 신호를 의도된 호스트가 수신할 수 있게 **프레임을 물리적인 전기 신호로 변환하는 방법을 정의**한다.

</br>

### 2.4.3 비신뢰성 통신

**의도된 호스트에 프레임이 전달될지 아닐지는 확률적으로 결정**되며 항상 보장되는 것은 아니다.

전기 신호를 훼손하지 않고 목적지까지 전달하는 데에는 많은 변수가 있어 영향을 끼친다.

전기적 간섭, 장비의 고장 등 물리적 매체에 장애가 발생한 경우 프레임이 누락되어 아예 전달되지 않을 수도 있다.

링크 계층에서는 **프레임의 도착 여부를 확인하거나 실패 시, 재전송을 하는 기능이 없다**. 따라서 링크 계층을 **비신뢰성 통신**이라고 한다.

보다 상위 프로토콜에서 신뢰성 통신을 구축하려면 재전송을 하는 등의 적절한 메커니즘을 직접 구현해야 한다.

</br>

### 2.4.4 링크 계층 프로토콜

물리 계층을 구현하고자 하는 물리적 연결 매체마다, 대응되는 하나 이상의 프로토콜이 링크 계층에 존재한다.

예를 들어 LAN 선으로 연결된 호스트 사이에서는 1000BASE-T와 같은 이더넷 계열 프로토콜로 통신한다.

전파로 연결된 호스트 사이에서는 단거리 와이 파이 프로토콜(802.11g, 802.11n, 802.11ac) 혹은 장거리 무선 프로토콜(4G, 5G)로 통신한다.

</br>

![제목 없음](https://github.com/user-attachments/assets/16449419-00f6-47a8-934f-731d907430ab)

</br>

링크 계층의 구현물과 물리 계층의 연결 매체가 서로 밀접하게 연관되어 있다 보니 일부 모형에서는 이 두 가지를 합쳐 하나의 계층으로도 묘사한다.

하지만 하나 이상의 링크 계층 프로토콜을 지원하는 물리적 연결 매체도 있으니, 서로 다른 계층으로 구별해 두는 편이 좋다.

</br>

### 2.4.5 게임과 링크 계층 프로토콜

서로 떨어진 두 호스트 사이에 인터넷 연결을 하고자 할 때, 꼭 한 쌍의 물리적 연결 매체와 링크 계층 프로토콜 조합만 쓰는 것은 아니다.

한 뭉치의 데이터를 보내는 과정에서도 **데이터가 서로 다른 여러 매체와 링크 프로토콜을 거쳐 갈 수도** 있다.

즉, 네트워크 컴퓨터 게임을 하면서 발생하는 데이터를 송신하는 과정에서, 위의 표에 등장한 다양한 링크 계층 프로토콜이 두루 이용될 수 있다.

</br>

다행히 TCP/IP 스택은 추상화가 잘 되어 있어 **구체적으로 어떻게 링크 계층을 타고 갈지 게임 시스템이 알아야 할 필요는 없다**.

따라서 여러 링크 프로토콜의 내부 동작 방식을 일일이 다루지 않으려고 한다. 하지만 **이더넷 프로토콜 그룹**만은 알아야만 한다. 

</br>

### 2.4.6 이더넷/802.3

이더넷 표준은 1980년도 DEC, 인텔, 제록스가 공동으로 제창하였으며 오늘날 **이더넷 프로토콜은 IEEE 802.3 표준으로 정의**하고 있다.

물리 계층의 매체마다 상응하는 이더넷 파생 프로토콜이 있으며, 속도에 따라 파생되는 프로토콜도 있다.

</br>

**여러 호스트를 식별**하기 위해 이더넷에서는 **매체 접근 제어(Media Access Control; MAC) 주소**를 사용한다.

MAC 주소는 **이론 상 고유한 48비트 숫자**로서 **이더넷 네트워크에 연결 가능한 장비마다 고유한 값으로 부여**된다.

이러한 장비를 통칭 **네트워크 인터페이스 컨트롤러**(Network Interface Controller; **NIC**)라고 부른다.

</br>

### 2.4.7 MAC 주소

MAC 주소는 범용 고유 식별자(Universally Unique Identifier, UUID)의 일종이다.

**기기마다 고유한 값을 부여**해야 하므로 NIC 제조업체는 **하드웨어 제조 과정에서 MAC 주소를 기기에 새겨** 넣는다.

첫 24비트는 제조업체 식별 코드로 **IEEE가 제조사마다 고유한 번호를 할당**해준다.

나머지 24비트는 제조업체의 책임으로, 제조사는 자신이 생산하는 **하드웨어 하나마다 고유값을 부여**해야 한다.

이와 같은 방식으로 제조된 NIC는 각각 그 주소로써 하드코딩된 고유 식별자를 사용하는 셈이다.

</br>

이더넷만 MAC 주소를 사용하는 것이 아닌 **IEEE 802 링크 계층 프로토콜**(와이파이, 블루투스)의 대부분이 MAC 주소를 사용하고 있다.

송수신 호스트에 각각 고유한 MAC 주소를 부여했을 때, 이더넷 링크 계층 프레임을 감싸는 이더넷 패킷이 구성된다.

</br>

![화면 캡처 2024-11-13 141247](https://github.com/user-attachments/assets/5f645f35-ebf9-4cdd-9089-ba251dc23a86)

</br>

### 2.4.8 이더넷 패킷의 구조

</br>

#### 프리앰블과 SFD

모든 이더넷 패킷은 **0x55 7개**에 **0xD5 1개** 총 8바이트의 16진수, 즉 55 55 55 55 55 55 55 D5로 시작하며 이를 **프리앰블**과 **SFD**라고 한다.

하위 계층의 하드웨어는 이러한 이진수 패턴을 체크하여 동기화를 맞추고 새 프레임을 받을 준비를 한다.

**프리앰블과 SFD는 보통 NIC 하드웨어가 걸러내며**, 프레임을 구성하는 **나머지 바이트 열을 이더넷 모듈에 넘겨 처리**한다.

</br>

#### 수신자의 주소

SFD 뒤에 따라붙는 6바이트는 프레임의 수신자로 설정된 기기의 MAC 주소를 나타낸다.

브로드캐스트 주소라는 특수 MAC 주소도 있는데, FF:FF:FF:FF:FF:FF:FF:FF로 나타내며 LAN 상 연결된 모든 호스트에 전달할 때 사용한다.

</br>

#### 길이/종류 필드

길이/종류 필드는 **오버로드하여 길이나 종류 둘 중 하나**로 사용한다.

**길이 필드**로 사용하는 경우, 프레임에 포함된 **페이로드의 길이를 바이트 단위로 나타낸다**.

**종류 필드**로 사용한 경우, 이더타입(EitherType) 고유 식별자 값을 기록해 **페이로드 내 데이터를 어떻게 해석해야 하는지 표시**한다.

이더넷 모듈이 이 필드를 처리할 때 정확하게 해석할 수 있게, 이더넷 표준은 페이로드의 최대 길이를 1500바이트로 정의해 두었다.

이를 **최대 전송 유닛**(Maximum Transmission Unit; **MTU**)라 하며, **한 번 전송에 최대한 담을 수 있는 데이터 양**을 의미한다.

이더넷 표준은 또한 이더타입의 최소값을 0x0600, 즉 10진수로는 1536으로 정해 두었다.

따라서 길이/종류 필드 값이 **1500 이하인 경우엔 길이로 해석**하고, **1536 이상인 경우엔 프로토콜 종류로 해석**하면 된다.

</br>

#### 페이로드

**페이로드**란 **프레임에 담겨 전송되는 데이터 그 자체**를 뜻한다. 대개 원하는 호스트로 전달하고 싶은 네트워크 계층 패킷이 담겨 있다.

</br>

#### 프레임 체크 시퀀스

**프레임 체크 시퀀스**(Frame Check Sequence; FCS)는 **CRC32** 값으로, 이는 여러 값에 걸쳐 **연산하여 얻은 체크썸 값**이다.

연산에 포함되는 것은 발신자/수신자 주소 각각, 길이/종류 필드, 페이로드, 패딩값 등이다.

이더넷 하드웨어가 데이터 수신 시 **이 값을 검사**하여 전송된 **데이터가 손상되었는지 판단**하고 만약 **손상된 경우 프레임을 폐기**해 버린다.

이더넷이 비록 데이터 전송을 보장하지는 못하지만 **적어도 훼손된 값이 전달되지는 않도록 보장**한다.

</br>

### 2.4.9 게임과 이더넷 패킷

사실 이더넷 패킷이 구체적으로 어떻게 물리 계층을 통과하여 매체를 타고 전달되는지는 멀티플레이어 게임 프로그래밍과는 큰 관련이 없다.

**네트워크상 호스트 중 하나가 해당 프레임을 받으면 호스트가 프레임을 읽어보고 그 수신자가 마침 자신일 때, 길이/종류 필드의 값에 따라 페이로드에서 데이터를 꺼내어 처리한다**, 라는 정도로 이해하자.
